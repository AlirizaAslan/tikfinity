<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TikFinity{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #fff; }
        
        #sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #1a1a1a; border-right: 1px solid #333; overflow-y: auto; z-index: 100; }
        .logo { padding: 20px; font-size: 1.5em; font-weight: bold; }
        .ttred { color: #fe2c55; }
        .separator { height: 1px; background: #333; margin: 10px 15px; }
        
        .channel-info { padding: 10px 15px; }
        .channel-info table { width: 100%; cursor: pointer; }
        .channel-info td { padding: 5px; }
        .roundImage { width: 50px; height: 50px; border-radius: 50%; }
        .status-text { color: #888; font-size: 0.9em; }
        .status-text.connected { color: #10b981; }
        .status-text.live { color: #fe2c55; font-weight: bold; }
        .status-text.offline { color: #888; }
        
        .menu-item { padding: 12px 20px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover { background: #252525; border-left-color: #fe2c55; }
        .menu-item.active { background: #252525; border-left-color: #fe2c55; color: #fe2c55; }
        .menu-item i { width: 20px; }
        
        .submenu-container { max-height: 0; overflow: hidden; transition: max-height 0.3s; background: #151515; }
        .submenu-container.open { max-height: 500px; }
        .submenu-item { padding: 12px 20px 12px 40px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; font-size: 0.9em; color: #aaa; }
        .submenu-item:hover { background: #252525; color: #fe2c55; border-left-color: #fe2c55; }
        
        .main-content { margin-left: 250px; padding: 30px; min-height: 100vh; }
        
        .section { background: #1a1a1a; padding: 30px; border-radius: 12px; margin-bottom: 20px; }
        .section h3 { color: #667eea; margin-bottom: 15px; }
        .field { margin-bottom: 20px; }
        .field label { display: block; margin-bottom: 8px; }
        .field input { width: 100%; max-width: 500px; padding: 12px; background: #252525; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; background: #667eea; color: white; margin: 5px; }
        .btn:hover { background: #5568d3; }
        .btn-success { background: #10b981; }
        .checkbox { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        table { width: 100%; max-width: 600px; border-collapse: collapse; }
        table td { padding: 10px; border-bottom: 1px solid #333; }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div id="sidebar">
        <div class="logo"><span class="ttred">Tik</span>Finity</div>
        <div class="separator"></div>
        
        <div class="channel-info">
            <table id="siebarChannelInfoTable" onclick="connectToTikTok()">
                <tr>
                    <td><img src="https://via.placeholder.com/100" class="roundImage myChannelThumbnail" onerror="this.src='https://via.placeholder.com/100'"></td>
                    <td>
                        <div id="siebarChannelInfoTableUsername">Not Connected</div>
                        <div id="siebarChannelInfoTableStatus" class="status-text">Click to connect!</div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="separator"></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'dashboard' or request.resolver_match.url_name == 'home' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:dashboard' %}'">
            <i class="fas fa-play"></i> Start
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'setup' %}active{% endif %}" onclick="toggleSubmenu(this)">
            <i class="fas fa-cog"></i> Setup
        </div>
        <div class="submenu-container {% if request.resolver_match.url_name == 'setup' %}open{% endif %}">
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:setup' %}'">TikTok Connection</div>
            <div class="submenu-item" onclick="scrollToSection('pointsSystemSettings')">Points System</div>
            <div class="submenu-item" onclick="scrollToSection('levelSettings')">Level Settings</div>
            <div class="submenu-item" onclick="scrollToSection('obsConnection')">OBS Integration</div>
            <div class="submenu-item" onclick="scrollToSection('advancedSettings')">Advanced Settings</div>
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-desktop"></i></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'overlay_gallery' %}active{% endif %}" onclick="toggleSubmenu(this)">
            <i class="fas fa-th"></i> Overlay Gallery
        </div>
        <div class="submenu-container {% if request.resolver_match.url_name == 'overlay_gallery' %}open{% endif %}">
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:overlay_gallery' %}'">All Overlays</div>
            <div class="submenu-item" onclick="scrollToOverlaySection('chat-overlay')">Chat Overlay</div>
            <div class="submenu-item" onclick="scrollToOverlaySection('gift-cannon')">Gift Cannon</div>
            <div class="submenu-item" onclick="scrollToOverlaySection('coin-match')">Coin Match</div>
            <div class="submenu-item" onclick="scrollToOverlaySection('viewer-count')">Viewer Count</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-bullseye"></i> Goal Overlays
        </div>
        <div class="submenu-container">
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'like-target' %}'">Likes PRO</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'share-target' %}'">Shares PRO</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'follow-target' %}'">Follows PRO</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'viewer-target' %}'">Viewer Count PRO</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'custom-targets' %}'">Custom Goals</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-gift"></i> Gift Overlays
        </div>
        <div class="submenu-container">
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:gift_overlays_sub' 'gift-notification' %}'">Rose</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:gift_overlays_sub' 'gift-bar' %}'">TikTok</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:gift_overlays_sub' 'gift-ranking' %}'">Finger Heart</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:gift_overlays_sub' 'settings' %}'">Doughnut</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-history"></i> Last X Overlays
        </div>
        <div class="submenu-container">
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'recent-followers' %}'">Last Follower</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'recent-gifts' %}'">Last Gifter</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'recent-comments' %}'">Last Subscriber</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'recent-shares' %}'">Last Sharer</div>
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'obs_panels' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:obs_panels' %}'">
            <i class="fas fa-video"></i> OBS Docks
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-bolt"></i></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'sound_alerts' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:sound_alerts' %}'">
            <i class="fas fa-volume-up"></i> Sound Alerts
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'automations' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:automations' %}'">
            <i class="fas fa-bolt"></i> Actions & Events
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="far fa-comments"></i></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'chat_commands' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:chat_commands' %}'">
            <i class="far fa-comments"></i> Chat Commands
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'auto_responses' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:auto_responses' %}'">
            <i class="fas fa-robot"></i> Chatbot
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'tts_chat' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:tts_chat' %}'">
            <i class="fas fa-microphone"></i> TTS Chat
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-list-ul"></i></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'users_points' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:users_points' %}'">
            <i class="fas fa-users"></i> User & Points
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'transactions' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:transactions' %}'">
            <i class="fas fa-exchange-alt"></i> Transactions
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-headphones"></i></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'song_requests' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:song_requests' %}'">
            <i class="fas fa-music"></i> Song Requests
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-gamepad"></i></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'likeathon' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:likeathon' %}'">
            <i class="fas fa-heart"></i> Likeathon
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'timer' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:timer' %}'">
            <i class="fas fa-clock"></i> Timer
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'wheel_fortune' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:wheel_fortune' %}'">
            <i class="fas fa-dharmachakra"></i> Wheel of Fortune
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'points_drop' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:points_drop' %}'">
            <i class="fas fa-coins"></i> Points Drop
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-tools"></i></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'challenge' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:challenge' %}'">
            <i class="fas fa-trophy"></i> Challenge
        </div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'split' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:split' %}'">
            <i class="fas fa-divide"></i> Halving
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-database"></i></div>
        
        <div class="menu-item {% if request.resolver_match.url_name == 'event_api' %}active{% endif %}" onclick="location.href='{% url 'tiktok_live:event_api' %}'">
            <i class="fas fa-code"></i> Event API
        </div>
    </div>
    
    <div class="main-content">
        {% block content %}{% endblock %}
    </div>

    <script>
        function toggleSubmenu(menuItem) {
            const submenu = menuItem.nextElementSibling;
            if (submenu && submenu.classList.contains('submenu-container')) {
                submenu.classList.toggle('open');
            }
        }
        
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function scrollToOverlaySection(overlayId) {
            // Navigate to overlay gallery first if not already there
            if (!window.location.pathname.includes('overlay-gallery')) {
                window.location.href = '{% url "tiktok_live:overlay_gallery" %}' + '#' + overlayId;
                return;
            }
            // If already on overlay gallery page, scroll to section
            const overlays = document.querySelectorAll('.obsOverlayOnPage');
            overlays.forEach(overlay => {
                const title = overlay.querySelector('h3')?.textContent.toLowerCase();
                if (title && title.includes(overlayId.replace('-', ' '))) {
                    overlay.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        }
        
        function connectToTikTok() {
            const username = document.getElementById('textboxChannelName')?.value.trim().replace('@', '');
            if (!username) { 
                alert('Please enter TikTok username first!');
                return;
            }
            localStorage.setItem('tiktok_username', username);
            document.getElementById('siebarChannelInfoTableUsername').textContent = username;
            document.getElementById('siebarChannelInfoTableStatus').textContent = 'OFFLINE';
            document.getElementById('siebarChannelInfoTableStatus').className = 'status-text offline';
            alert('âœ… Connected to @' + username);
            checkLiveStatus(username);
        }
        
        function checkLiveStatus(username) {
            fetch(`/tiktok/api/check-live/${username}/`)
                .then(res => res.json())
                .then(data => {
                    const statusEl = document.getElementById('siebarChannelInfoTableStatus');
                    if (data.is_live) {
                        statusEl.textContent = 'LIVE';
                        statusEl.className = 'status-text live';
                    } else {
                        statusEl.textContent = 'OFFLINE';
                        statusEl.className = 'status-text offline';
                    }
                })
                .catch(() => {
                    document.getElementById('siebarChannelInfoTableStatus').textContent = 'OFFLINE';
                    document.getElementById('siebarChannelInfoTableStatus').className = 'status-text offline';
                });
        }
        
        window.onload = function() {
            const saved = localStorage.getItem('tiktok_username');
            if (saved) {
                const usernameInput = document.getElementById('textboxChannelName');
                if (usernameInput) usernameInput.value = saved;
                document.getElementById('siebarChannelInfoTableUsername').textContent = saved;
                checkLiveStatus(saved);
                setInterval(() => checkLiveStatus(saved), 30000);
            }
            
            // Handle overlay section scrolling from URL hash
            if (window.location.hash && window.location.pathname.includes('overlay-gallery')) {
                const overlayId = window.location.hash.substring(1);
                setTimeout(() => scrollToOverlaySection(overlayId), 500);
            }
        };
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>