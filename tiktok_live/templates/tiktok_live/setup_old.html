<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikFinity - Setup</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f0f; color: #fff; }
        
        .sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #1a1a1a; border-right: 1px solid #333; overflow-y: auto; z-index: 100; }
        .sidebar-header { padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        .menu-item { padding: 15px 20px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; display: flex; align-items: center; gap: 12px; }
        .menu-item:hover { background: #252525; border-left-color: #667eea; }
        .menu-item.active { background: #252525; border-left-color: #667eea; color: #667eea; }
        
        .submenu { max-height: 0; overflow: hidden; transition: max-height 0.3s; background: #151515; }
        .submenu.open { max-height: 800px; }
        .submenu-item { padding: 12px 20px 12px 52px; cursor: pointer; transition: all 0.3s; font-size: 0.9em; color: #aaa; }
        .submenu-item:hover { background: #252525; color: #667eea; }
        
        .main-content { margin-left: 250px; padding: 30px; min-height: 100vh; }
        .greyBackgroundSection { background: #1a1a1a; padding: 30px; border-radius: 12px; margin-bottom: 20px; scroll-margin-top: 20px; }
        .blueheading { margin-bottom: 10px; color: #667eea; }
        .noTopMarginHeader { margin-top: 0; }
        
        .dx-field { margin-bottom: 25px; }
        .dx-field-label { display: block; margin-bottom: 8px; font-weight: 500; }
        .dx-texteditor-input, .dx-numberbox input { width: 100%; max-width: 400px; padding: 12px; border: 1px solid #333; background: #252525; color: #fff; border-radius: 8px; font-size: 1em; }
        
        .dx-button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; transition: all 0.3s; background: #667eea; color: white; display: inline-block; margin-top: 10px; }
        .dx-button:hover { background: #5568d3; }
        
        .dx-checkbox { display: flex; align-items: center; gap: 10px; margin: 10px 0; cursor: pointer; }
        .dx-checkbox input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        
        .ttred { color: #ef4444; }
        .proColor { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .tw-preflight { padding: 20px; }
        .grid { display: grid; }
        .grid-cols-\\[4fr_3fr_4fr\\] { grid-template-columns: 4fr 3fr 4fr; }
        
        table { width: 100%; border-collapse: collapse; }
        table td { padding: 10px; border-bottom: 1px solid #333; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>ðŸŽ¥ TikFinity</h2>
            <p style="font-size: 0.85em; opacity: 0.9;">Live Stream Manager</p>
        </div>
        
        <div style="padding: 15px 20px; color: #888; font-size: 0.75em; text-transform: uppercase;">START</div>
        
        <div class="menu-item active" onclick="toggleSubmenu(this)">
            <i class="fas fa-cog"></i> Setup <i class="fas fa-chevron-down" style="margin-left: auto; font-size: 0.8em;"></i>
        </div>
        <div class="submenu open">
            <div class="submenu-item" onclick="scrollTo('#tiktokName')">Your TikTok Name</div>
            <div class="submenu-item" onclick="scrollTo('#pointsSystemSettings')">Points System</div>
            <div class="submenu-item" onclick="scrollTo('#subscriberBonus')">Subscriber Bonus</div>
            <div class="submenu-item" onclick="scrollTo('#levelSettings')">Level Settings</div>
            <div class="submenu-item" onclick="scrollTo('#obsConnection')">OBS Connection</div>
            <div class="submenu-item" onclick="scrollTo('#streamerbotConfig')">Streamer.bot</div>
            <div class="submenu-item" onclick="scrollTo('#minecraftConnection')">Minecraft</div>
            <div class="submenu-item" onclick="scrollTo('#resetPoints')">Reset Points</div>
            <div class="submenu-item" onclick="scrollTo('#setupPro')">TikFinity Pro ðŸš€</div>
            <div class="submenu-item" onclick="scrollTo('#accountSection')">Your Account</div>
            <div class="submenu-item" onclick="scrollTo('#advancedSettings')">Advanced Settings</div>
        </div>
        
        <div style="height: 1px; background: #333; margin: 15px 0;"></div>
        <div class="menu-item" onclick="location.href='/tiktok/'">
            <i class="fas fa-th-large"></i> Dashboard
        </div>
    </div>
    
    <div class="main-content">
        <div class="setHalfOpacitityOnUnregistered">
            <div class="setupConnected">
                <div>Here you can define the basic settings.</div>

                <br><br>
                <div class="greyBackgroundSection" id="tiktokName">
                    <div class="dx-field">
                        <div class="dx-field-label">Your TikTok Name (<i class="ttred">Required!</i>)</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="text" placeholder="TikTok @username" id="textboxChannelName" onkeyup="if(event.key==='Enter') saveTikTokUsername()">
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <div class="dx-button" onclick="saveTikTokUsername()" style="background: #10b981;"><i class="fas fa-save"></i> Save Username</div>
                                <div class="dx-button" id="manualConnectButtonSetup" style="display: none;"><i class="fas fa-broadcast-tower"></i> Connect to TikTok LIVE</div>
                            </div>
                        </div>
                    </div>
                </div>

                <br><br>
                <div class="greyBackgroundSection" id="pointsSystemSettings">
                    <h3 class="blueheading noTopMarginHeader">Points System</h3>

                    <div class="dx-field">
                        <div class="dx-field-label">Name of your currency</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="text" value="Points">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">
                            <div class="dx-checkbox">
                                <input type="checkbox" checked> <span>Points per coin</span>
                            </div>
                        </div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="1" min="0" max="50" step="0.01">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">
                            <div class="dx-checkbox">
                                <input type="checkbox"> <span>Points per share</span>
                            </div>
                        </div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="3" min="0" max="100000">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">
                            <div class="dx-checkbox">
                                <input type="checkbox"> <span>Points per chat minute</span>
                            </div>
                        </div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="0.5" min="0" max="50000" step="0.01">
                        </div>
                    </div>
                </div>

                <br><br>
                <div class="greyBackgroundSection" id="subscriberBonus">
                    <h3 class="blueheading noTopMarginHeader">Subscriber Bonus</h3>
                    <div>If you have subscribers, you can set a points multiplier for them.<br>Then your subscribers will get more points for their activities.</div><br>

                    <div class="dx-field">
                        <div class="dx-field-label">Subscriber Bonus Ratio</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="0" min="0" max="100" step="1">
                        </div>
                    </div>
                </div>

                <br><br>
                <div class="greyBackgroundSection" id="levelSettings">
                    <h3 class="blueheading noTopMarginHeader">Level Settings</h3>
                    <div>Viewers can increase their level by collecting points. In Level Points you set how many points are required to reach the next level.</div><br>

                    <div class="dx-field">
                        <div class="dx-field-label">Level Points</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="50" min="1" max="10000">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">Level Multiplier</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="1.03" min="1" max="1.1" step="0.01">
                        </div>
                    </div>
                </div>

                <br><br>
                <div class="greyBackgroundSection" id="obsConnection">
                    <h3 class="blueheading noTopMarginHeader">OBS Connection</h3>
                    <div>You can control OBS via TikFinity to switch scenes and sources automatically on certain events.<br>This requires OBS 28 or newer!<br><br>In OBS click "Tools" &gt; "WebSocket Server Settings" and enable the Websocket Server.</div><br>

                    <div class="dx-field">
                        <div class="dx-field-label">IP</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="text" placeholder="127.0.0.1">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">Port</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="4455">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">Password</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="password" placeholder="(optional)">
                        </div>
                    </div>

                    <div class="dx-button">Test Connection</div>
                </div>

                <br><br>
                <div class="greyBackgroundSection" id="streamerbotConfig">
                    <h3 class="blueheading noTopMarginHeader">Streamer.bot Connection</h3>
                    <div><a href="https://streamer.bot/" target="_blank">Streamer.bot</a> is one of the most popular tools for streamers!<br>With the TikFinity integration you can trigger your Streamer.bot Actions via TikFinity.</div><br>

                    <div class="dx-field">
                        <div class="dx-field-label">Address</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="text" placeholder="127.0.0.1">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">Port</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="8080">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">Endpoint</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="text" placeholder="/">
                        </div>
                    </div>

                    <div class="dx-button">Test Connection</div>
                </div>

                <br><br>
                <div class="greyBackgroundSection" id="minecraftConnection">
                    <h3 class="blueheading noTopMarginHeader">Minecraft Connection</h3>
                    <div>Control Minecraft via TikFinity to summon Mobs or execute custom commands.<br>This requires the official TikFinity Mod installed in your Minecraft Client!</div><br>

                    <div class="dx-field">
                        <div class="dx-field-label">Player Name</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="text" placeholder="(required for ServerTap Plugin)">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">IP</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="text" placeholder="127.0.0.1">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">Port</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="number" value="4567">
                        </div>
                    </div>

                    <div class="dx-field">
                        <div class="dx-field-label">Password</div>
                        <div class="dx-field-value">
                            <input class="dx-texteditor-input" type="text" placeholder="Password from config.yml">
                        </div>
                    </div>

                    <div class="dx-button">Test Connection</div>
                </div>

                <br><br>
                <div class="greyBackgroundSection" id="resetPoints">
                    <h3 class="blueheading noTopMarginHeader">Reset Points</h3>
                    <div>Use the following buttons to reset the Points and Levels by criteria or of all users:</div><br>
                    <div class="dx-button">Erase Points and Levels by criteria</div>
                    <div class="dx-button">Erase all Points and Levels</div>
                </div>

                <br><br><br>
                <div class="tw-preflight greyBackgroundSection" id="setupPro" style="min-height: 600px;">
                    <h3 class="proColor noTopMarginHeader">TikFinity Pro ðŸš€</h3>
                    
                    <table style="margin-top: 30px;">
                        <tr>
                            <td><strong>Feature</strong></td>
                            <td><strong>Free</strong></td>
                            <td><strong>Pro</strong></td>
                        </tr>
                        <tr>
                            <td>Actions & Events</td>
                            <td>5</td>
                            <td><i class="fas fa-infinity"></i></td>
                        </tr>
                        <tr>
                            <td>Sound Alerts</td>
                            <td>5</td>
                            <td><i class="fas fa-infinity"></i></td>
                        </tr>
                        <tr>
                            <td>Daily TTS Snippets</td>
                            <td>100</td>
                            <td><i class="fas fa-infinity"></i></td>
                        </tr>
                        <tr>
                            <td>Premium Overlays</td>
                            <td>-</td>
                            <td><i class="fas fa-check"></i></td>
                        </tr>
                        <tr>
                            <td>AI Voices</td>
                            <td>-</td>
                            <td><i class="fas fa-check"></i></td>
                        </tr>
                        <tr>
                            <td>Gift Counter</td>
                            <td>1</td>
                            <td>3</td>
                        </tr>
                        <tr>
                            <td>Stream Profiles</td>
                            <td>1</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>Points System Users</td>
                            <td>2.5k</td>
                            <td>100k</td>
                        </tr>
                    </table>

                    <div class="dx-button" style="margin-top: 30px; background: #fbbf24;">Upgrade to Pro</div>
                </div>

                <div class="setupConnected">
                    <br><br><br>
                    <div class="greyBackgroundSection" id="accountSection">
                        <h3 class="blueheading noTopMarginHeader">Your Account</h3><br>
                        <table>
                            <tr>
                                <td>User-ID</td>
                                <td class="accountInfoUserId">{{ user.id|default:"Not logged in" }}</td>
                            </tr>
                            <tr>
                                <td>E-Mail</td>
                                <td class="accountInfoEmail">{{ user.email|default:"N/A" }}</td>
                            </tr>
                            <tr>
                                <td>Signup Date</td>
                                <td class="accountInfoSignupDate">{{ user.date_joined|date:"d.m.Y"|default:"N/A" }}</td>
                            </tr>
                        </table>
                        <br>
                        {% if user.is_authenticated %}
                        <div class="dx-button" onclick="location.href='/tiktok/logout/'">Logout</div>
                        {% else %}
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <div class="dx-button" onclick="location.href='{% url 'tiktok_live:tiktok_oauth_login' %}'" style="background: #000; display: flex; align-items: center; gap: 8px;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#fff"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
                                Login with TikTok
                            </div>
                            <div class="dx-button" onclick="location.href='{% url 'tiktok_live:google_oauth_login' %}'" style="background: #fff; color: #333; display: flex; align-items: center; gap: 8px;">
                                <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                Login with Google
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <br><br><br>
                    <div class="greyBackgroundSection" id="advancedSettings">
                        <h3 class="blueheading noTopMarginHeader">Advanced Settings</h3>

                        <div class="dx-checkbox">
                            <input type="checkbox" checked> <span>Use localized gift names in overlays</span>
                        </div>
                        <div class="dx-checkbox">
                            <input type="checkbox" checked> <span>Use display names of users in overlays (instead @-handles)</span>
                        </div>
                        <div class="dx-checkbox">
                            <input type="checkbox" checked> <span>Process only first emote of message by Actions & Events</span>
                        </div>

                        <br>
                        <div class="dx-field">
                            <div class="dx-field-label">TikTok Language</div>
                            <div class="dx-field-value">
                                <input class="dx-texteditor-input" type="text" placeholder="en-US" maxlength="5">
                                <small>Relevant for localized gifts. Example: en-US</small>
                            </div>
                        </div>

                        <br><br><br>
                        <h3 class="blueheading noTopMarginHeader">Debug Options</h3>
                        <div>This function is used to identify errors.<br>Activate it when prompted by the TikFinity Support Team!</div><br>
                        <div class="dx-button"><i class="fas fa-warning"></i> Enable Debug Mode</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleSubmenu(element) {
            const submenu = element.nextElementSibling;
            submenu.classList.toggle('open');
        }
        
        function scrollTo(id) {
            document.querySelector(id).scrollIntoView({ behavior: 'smooth' });
        }
        
        // Save TikTok username
        function saveTikTokUsername() {
            const input = document.getElementById('textboxChannelName');
            const username = input.value.trim().replace('@', '');
            
            if (!username) {
                alert('Please enter your TikTok username');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('tiktok_username', username);
            
            // Save to session via AJAX
            fetch('/tiktok/account/add/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    username: username,
                    is_owner: true
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('âœ… TikTok username saved: @' + username);
                    document.getElementById('manualConnectButtonSetup').style.display = 'block';
                } else {
                    alert('âŒ Error: ' + (data.error || 'Failed to save username'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('âœ… Username saved locally: @' + username);
                document.getElementById('manualConnectButtonSetup').style.display = 'block';
            });
        }
        
        // Get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // Load saved username on page load
        window.onload = function() {
            const saved = localStorage.getItem('tiktok_username');
            if (saved) {
                document.getElementById('textboxChannelName').value = saved;
                document.getElementById('manualConnectButtonSetup').style.display = 'block';
            }
        };
        
        // Connect button handler
        document.addEventListener('DOMContentLoaded', function() {
            const connectBtn = document.getElementById('manualConnectButtonSetup');
            if (connectBtn) {
                connectBtn.addEventListener('click', function() {
                    const username = document.getElementById('textboxChannelName').value.trim().replace('@', '');
                    if (username) {
                        window.location.href = '/tiktok/live/' + username + '/';
                    } else {
                        alert('Please enter your TikTok username first');
                    }
                });
            }
        });
    </script>
</body>
</html>
