<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikFinity - Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f0f; color: #fff; overflow-x: hidden; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #1a1a1a; border-right: 1px solid #333; overflow-y: auto; z-index: 100; padding-bottom: 100px; }
        .sidebar::-webkit-scrollbar { width: 8px; }
        .sidebar::-webkit-scrollbar-track { background: #0f0f0f; }
        .sidebar::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        .sidebar::-webkit-scrollbar-thumb:hover { background: #444; }
        .sidebar-header { padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .sidebar-header h2 { font-size: 1.5em; }
        .ttred { color: #fe2c55; }
        
        .menu-item { padding: 15px 20px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; display: flex; align-items: center; gap: 12px; position: relative; }
        .menu-item:hover { background: #252525; border-left-color: #667eea; }
        .menu-item.active { background: #252525; border-left-color: #667eea; color: #667eea; }
        .menu-item i { width: 20px; text-align: center; }
        .menu-item.has-submenu::after { content: '\f107'; font-family: 'Font Awesome 6 Free'; font-weight: 900; margin-left: auto; transition: transform 0.3s; }
        .menu-item.has-submenu.open::after { transform: rotate(180deg); }
        
        .menu-separator { height: 1px; background: #333; margin: 15px 0; }
        .menu-category { padding: 10px 20px; font-size: 0.75em; color: #888; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        
        .submenu { max-height: 0; overflow: hidden; transition: max-height 0.3s; background: #151515; }
        .submenu.open { max-height: 500px; }
        .submenu-item { padding: 12px 20px 12px 52px; cursor: pointer; transition: all 0.3s; font-size: 0.9em; }
        .submenu-item:hover { background: #252525; color: #667eea; }
        
        .new-badge { font-size: 0.65em; color: #fe2c55; vertical-align: top; margin-left: 5px; }
        
        /* Main Content */
        .main-content { margin-left: 250px; padding: 30px; min-height: 100vh; width: calc(100% - 250px); background: #0f0f0f; }
        .top-bar { background: #1a1a1a; padding: 20px; border-radius: 12px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #1a1a1a; padding: 25px; border-radius: 12px; border-left: 4px solid #667eea; }
        .stat-card h3 { color: #888; font-size: 0.9em; margin-bottom: 10px; }
        .stat-card .value { font-size: 2em; font-weight: bold; color: #667eea; }
        
        .accounts-section { background: #1a1a1a; padding: 25px; border-radius: 12px; margin-bottom: 30px; }
        .account-card { background: #252525; padding: 20px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .account-info { flex: 1; }
        .account-actions { display: flex; gap: 10px; align-items: center; }
        .connection-status { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-left: 10px; }
        .status-connected { background: #10b981; }
        .status-disconnected { background: #ef4444; }
        .status-connecting { background: #fbbf24; }
        .menu-item .connection-status { margin-left: auto; width: 8px; height: 8px; cursor: help; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; transition: all 0.3s; text-decoration: none; display: inline-block; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        
        .owner-badge { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); padding: 3px 10px; border-radius: 12px; font-size: 0.75em; margin-left: 8px; }
        .active-badge { background: #10b981; padding: 5px 15px; border-radius: 20px; font-size: 0.85em; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
        .modal-content { background: #1a1a1a; max-width: 500px; margin: 100px auto; padding: 30px; border-radius: 12px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #888; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #333; background: #252525; color: #fff; border-radius: 8px; font-size: 1em; }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar { width: 200px; }
            .main-content { margin-left: 200px; width: calc(100% - 200px); padding: 20px; }
            .stats-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 576px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2><span class="ttred">Tik</span>Finity</h2>
            <p style="font-size: 0.85em; opacity: 0.9;">Live Stream Manager</p>
        </div>
        
        <div class="menu-category"><i class="fas fa-home"></i> ANA MENÃœ</div>
        <div class="menu-item active" onclick="location.href='{% url 'tiktok_live:dashboard' %}'">
            <i class="fas fa-th-large"></i> BaÅŸlangÄ±Ã§
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:setup' %}'">
            <i class="fas fa-cog"></i> Kurulum
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-desktop"></i> OVERLAY'LER</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:overlay_gallery' %}'">
            <i class="fas fa-layer-group"></i> Overlay Galerisi
        </div>
        <div class="menu-item has-submenu" onclick="toggleSubmenu(this, event)">
            <i class="fas fa-bullseye"></i> Hedef Overlay'leri
        </div>
        <div class="submenu">
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'like-target' %}'">BeÄŸeni Hedefi</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'share-target' %}'">PaylaÅŸÄ±m Hedefi</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'follow-target' %}'">Takip Hedefi</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'viewer-target' %}'">Ä°zleyici SayÄ±sÄ± Hedefi</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'coin-target' %}'">KazanÄ±lan Coin Hedefi</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'custom-targets' %}'">Ã–zel Hedefler</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:target_overlays_sub' 'settings' %}'">Ayarlar</div>
        </div>
        <div class="menu-item has-submenu" onclick="toggleSubmenu(this, event)">
            <i class="fas fa-gift"></i> Hediye Overlay'leri <span class="new-badge">YENÄ°</span>
        </div>
        <div class="submenu">
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:gift_overlays_sub' 'gift-notification' %}'">Hediye Bildirim Overlay'i</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:gift_overlays_sub' 'gift-bar' %}'">Hediye Bar Overlay'i</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:gift_overlays_sub' 'gift-ranking' %}'">Hediye SÄ±ralamasÄ±</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:gift_overlays_sub' 'settings' %}'">Ayarlar</div>
        </div>
        <div class="menu-item has-submenu" onclick="toggleSubmenu(this, event)">
            <i class="fas fa-history"></i> Son X Overlay'leri
        </div>
        <div class="submenu">
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'recent-comments' %}'">Son Yorumlar</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'recent-gifts' %}'">Son Hediyeler</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'recent-followers' %}'">Son TakipÃ§iler</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'recent-shares' %}'">Son PaylaÅŸÄ±mlar</div>
            <div class="submenu-item" onclick="location.href='{% url 'tiktok_live:recent_overlays_sub' 'settings' %}'">Ayarlar</div>
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:obs_panels' %}'">
            <i class="fas fa-window-restore"></i> OBS Panelleri <span class="new-badge">YENÄ°</span>
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-bolt"></i> OTOMASYON</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:sound_alerts' %}'">
            <i class="fas fa-volume-up"></i> Ses UyarÄ±larÄ±
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:automations' %}'">
            <i class="fas fa-robot"></i> Aksiyonlar & Etkinlikler
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="far fa-comments"></i> SOHBET</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:chat_commands' %}'">
            <i class="fas fa-terminal"></i> Sohbet KomutlarÄ±
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:auto_responses' %}'">
            <i class="fas fa-comment-dots"></i> Sohbet Botu
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:tts_chat' %}'">
            <i class="fas fa-microphone"></i> TTS Sohbet
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-list-ul"></i> KULLANICILAR</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:users_points' %}'">
            <i class="fas fa-users"></i> KullanÄ±cÄ±lar & Puanlar
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:transactions' %}'">
            <i class="fas fa-exchange-alt"></i> Ä°ÅŸlemler
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-headphones"></i> MÃœZÄ°K</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:song_requests' %}'">
            <i class="fas fa-music"></i> ÅarkÄ± Ä°stekleri
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-gamepad"></i> OYUNLAR & ARAÃ‡LAR</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:likeathon' %}'">
            <i class="fas fa-heart-broken"></i> Likeathon <span class="new-badge">YENÄ°</span>
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:timer' %}'">
            <i class="fas fa-clock"></i> ZamanlayÄ±cÄ±
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:wheel_fortune' %}'">
            <i class="fas fa-circle-notch"></i> Åans Ã‡arkÄ±
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:points_drop' %}'">
            <i class="fas fa-coins"></i> Puan DÃ¼ÅŸÃ¼r
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-tools"></i> ARAÃ‡LAR</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:challenge' %}'">
            <i class="fas fa-trophy"></i> Meydan Okuma
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:halving' %}'">
            <i class="fas fa-divide"></i> YarÄ±lama
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-database"></i> CANLI YAYINLAR</div>
        
        {% for account in owned_accounts %}
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:live_stream' account.username %}'">
            <i class="fas fa-video"></i> @{{ account.username }}
            <span class="connection-status status-disconnected" style="margin-left: auto; width: 8px; height: 8px;" title="BaÄŸlÄ± deÄŸil"></span>
        </div>
        {% endfor %}
        
        <div class="menu-item" onclick="openAddAccountModal()">
            <i class="fas fa-plus-circle"></i> Hesap Ekle
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-chart-line"></i> Ä°STATÄ°STÄ°KLER</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:my_streams' %}'">
            <i class="fas fa-chart-bar"></i> YayÄ±n Ä°statistikleri
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:viewer_analysis' %}'">
            <i class="fas fa-users"></i> Ä°zleyici Analizi
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:event_api' %}'">
            <i class="fas fa-database"></i> Etkinlik API <span class="new-badge">YENÄ°</span>
        </div>
        
        <div class="menu-separator"></div>
        <div class="menu-category"><i class="fas fa-cog"></i> AYARLAR</div>
        
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:profile_settings' %}'">
            <i class="fas fa-user-cog"></i> Profil AyarlarÄ±
        </div>
        <div class="menu-item" onclick="location.href='{% url 'tiktok_live:logout' %}'">
            <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ Yap
        </div>
        
        <div style="padding: 20px; margin-top: 20px; border-top: 1px solid #333;">
            <div style="font-size: 0.8em; color: #888; margin-bottom: 10px;">v1.0.0</div>
            <div style="font-size: 0.75em; color: #666;">
                <a href="#" style="color: #666; text-decoration: none;">KullanÄ±m ÅartlarÄ±</a> â€¢ 
                <a href="#" style="color: #666; text-decoration: none;">Gizlilik</a>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="top-bar">
            <div>
                <h1 style="font-size: 1.8em; margin-bottom: 5px;">Dashboard</h1>
                <p style="color: #888;">HoÅŸ geldin, {{ user.username }}!</p>
            </div>
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <div style="font-weight: bold;">{{ user.username }}</div>
                    <div style="font-size: 0.85em; color: #888;">{{ user.email }}</div>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Toplam Hesap</h3>
                <div class="value">{{ accounts.count }}</div>
            </div>
            <div class="stat-card">
                <h3>Aktif YayÄ±nlar</h3>
                <div class="value">{{ active_streams.count }}</div>
            </div>
            <div class="stat-card">
                <h3>BugÃ¼nkÃ¼ EtkileÅŸim</h3>
                <div class="value">0</div>
            </div>
            <div class="stat-card">
                <h3>Toplam Hediye DeÄŸeri</h3>
                <div class="value">0 ğŸ’</div>
            </div>
        </div>

        <div class="accounts-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>TikTok HesaplarÄ±m</h2>
                <button class="btn btn-primary" onclick="openAddAccountModal()">+ Hesap Ekle</button>
            </div>

            {% if owned_accounts %}
            <h3 style="margin-bottom: 15px; color: #fbbf24;">ğŸ‘‘ Sahip OlduÄŸum Hesaplar</h3>
            {% for account in owned_accounts %}
            <div class="account-card" style="border-left: 4px solid #fbbf24;">
                <div class="account-info">
                    <h3>@{{ account.username }}
                        <span class="owner-badge">ğŸ‘‘ Sahip</span>
                        {% if account.is_verified_owner %}
                        <span style="color: #10b981; margin-left: 5px;">âœ“ DoÄŸrulanmÄ±ÅŸ</span>
                        {% endif %}
                    </h3>
                    <div style="display: flex; align-items: center; margin-top: 5px;">
                        <span class="active-badge">Aktif</span>
                        <span class="connection-status status-disconnected" title="BaÄŸlantÄ± durumu: BaÄŸlÄ± deÄŸil"></span>
                        <span style="font-size: 0.85em; color: #888; margin-left: 10px;">BaÄŸlÄ± deÄŸil</span>
                    </div>
                </div>
                <div class="account-actions">
                    <a href="{% url 'tiktok_live:live_stream' account.username %}" class="btn btn-success">CanlÄ± YayÄ±na BaÄŸlan</a>
                    <a href="{% url 'tiktok_live:my_streams' %}" class="btn btn-primary">ğŸ“Š Ä°statistikler</a>
                </div>
            </div>
            {% endfor %}
            {% endif %}

            {% if monitored_accounts %}
            <h3 style="margin-top: 30px; margin-bottom: 15px; color: #667eea;">ğŸ‘ï¸ Ä°zlediÄŸim Hesaplar</h3>
            {% for account in monitored_accounts %}
            <div class="account-card">
                <div class="account-info">
                    <h3>@{{ account.username }}</h3>
                    <div style="display: flex; align-items: center; margin-top: 5px;">
                        <span class="active-badge">Aktif</span>
                        <span class="connection-status status-disconnected" title="BaÄŸlantÄ± durumu: BaÄŸlÄ± deÄŸil"></span>
                        <span style="font-size: 0.85em; color: #888; margin-left: 10px;">BaÄŸlÄ± deÄŸil</span>
                    </div>
                </div>
                <div class="account-actions">
                    <a href="{% url 'tiktok_live:live_stream' account.username %}" class="btn btn-success">CanlÄ± YayÄ±na BaÄŸlan</a>
                </div>
            </div>
            {% endfor %}
            {% endif %}

            {% if not accounts %}
            <p style="text-align: center; color: #888; padding: 40px;">HenÃ¼z hesap eklemediniz. BaÅŸlamak iÃ§in yukarÄ±daki butona tÄ±klayÄ±n.</p>
            {% endif %}
        </div>
    </div>

    <!-- Modal -->
    <div id="addAccountModal" class="modal">
        <div class="modal-content">
            <h2>Yeni Hesap Ekle</h2>
            <form onsubmit="event.preventDefault(); addAccount();">
                <div class="form-group">
                    <label>TikTok KullanÄ±cÄ± AdÄ±</label>
                    <input type="text" id="username" placeholder="@kullaniciadi" onkeypress="handleModalKeyPress(event)">
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="is_owner" style="width: auto; margin-right: 10px;">
                        <span>ğŸ‘‘ Bu benim TikTok hesabÄ±m</span>
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" type="button" onclick="addAccount()">Ekle</button>
                    <button class="btn btn-danger" type="button" onclick="closeAddAccountModal()">Ä°ptal</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Toggle submenu
        function toggleSubmenu(menuItem, event) {
            event.stopPropagation();
            
            // Get the next sibling element (submenu)
            const submenu = menuItem.nextElementSibling;
            
            // Check if the clicked item has a submenu
            if (submenu && submenu.classList.contains('submenu')) {
                // Toggle the submenu
                submenu.classList.toggle('open');
                menuItem.classList.toggle('open');
                
                // Close other open submenus
                const allMenuItems = document.querySelectorAll('.menu-item.has-submenu');
                allMenuItems.forEach(item => {
                    if (item !== menuItem) {
                        item.classList.remove('open');
                        const otherSubmenu = item.nextElementSibling;
                        if (otherSubmenu && otherSubmenu.classList.contains('submenu')) {
                            otherSubmenu.classList.remove('open');
                        }
                    }
                });
            }
        }

        function openAddAccountModal() {
            document.getElementById('addAccountModal').style.display = 'block';
            // Focus on username input
            setTimeout(() => {
                document.getElementById('username').focus();
            }, 100);
        }

        function closeAddAccountModal() {
            document.getElementById('addAccountModal').style.display = 'none';
        }

        // Handle Enter key in modal
        function handleModalKeyPress(event) {
            if (event.key === 'Enter') {
                addAccount();
            }
        }

        async function addAccount() {
            const username = document.getElementById('username').value.trim();
            const isOwner = document.getElementById('is_owner').checked;
            
            if (!username) {
                alert('LÃ¼tfen kullanÄ±cÄ± adÄ± girin');
                return;
            }

            const response = await fetch('{% url "tiktok_live:add_account" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ 
                    username: username,
                    is_owner: isOwner 
                })
            });

            const data = await response.json();
            if (data.success) {
                alert(data.message || 'Hesap baÅŸarÄ±yla eklendi!');
                location.reload();
            } else {
                alert(data.error || 'Bir hata oluÅŸtu');
            }
        }
        
        function openOverlay(widgetId) {
            const baseUrl = '{% url "tiktok_live:widget_view" "WIDGET_ID" %}'.replace('WIDGET_ID', widgetId);
            const userId = '{{ user.id|default:"2449591" }}';
            const overlayUrl = baseUrl + '?cid=' + userId + '&preview=1';
            window.open(overlayUrl, '_blank', 'width=900,height=600');
        }
    </script>
</body>
</html>
