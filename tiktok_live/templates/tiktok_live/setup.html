<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikFinity - Setup</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #fff; }
        
        #sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #1a1a1a; border-right: 1px solid #333; overflow-y: auto; z-index: 100; }
        .logo { padding: 20px; font-size: 1.5em; font-weight: bold; }
        .ttred { color: #fe2c55; }
        .separator { height: 1px; background: #333; margin: 10px 15px; }
        
        .channel-info { padding: 10px 15px; }
        .channel-info table { width: 100%; cursor: pointer; }
        .channel-info td { padding: 5px; }
        .roundImage { width: 50px; height: 50px; border-radius: 50%; }
        .status-text { color: #888; font-size: 0.9em; }
        .status-text.connected { color: #10b981; }
        .status-text.live { color: #fe2c55; font-weight: bold; }
        .status-text.offline { color: #888; }
        
        .menu-item { padding: 12px 20px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover { background: #252525; border-left-color: #fe2c55; }
        .menu-item.active { background: #252525; border-left-color: #fe2c55; color: #fe2c55; }
        .menu-item i { width: 20px; }
        
        #submenuPanel { position: fixed; left: 250px; top: 0; width: 250px; height: 100vh; background: #1a1a1a; border-right: 1px solid #333; overflow-y: auto; z-index: 99; transform: translateX(-100%); transition: transform 0.3s; }
        #submenuPanel.open { transform: translateX(0); }
        .panel-title { padding: 20px; font-size: 1.2em; font-weight: bold; border-bottom: 1px solid #333; }
        .submenu-item { padding: 15px 20px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; }
        .submenu-item:hover { background: #252525; color: #fe2c55; border-left-color: #fe2c55; }
        
        .main-content { margin-left: 250px; padding: 30px; min-height: 100vh; transition: margin-left 0.3s; }
        .main-content.shifted { margin-left: 500px; }
        
        .section { background: #1a1a1a; padding: 30px; border-radius: 12px; margin-bottom: 20px; }
        .section h3 { color: #667eea; margin-bottom: 15px; }
        .field { margin-bottom: 20px; }
        .field label { display: block; margin-bottom: 8px; }
        .field input { width: 100%; max-width: 500px; padding: 12px; background: #252525; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; background: #667eea; color: white; margin: 5px; }
        .btn:hover { background: #5568d3; }
        .btn-success { background: #10b981; }
        .checkbox { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        table { width: 100%; max-width: 600px; border-collapse: collapse; }
        table td { padding: 10px; border-bottom: 1px solid #333; }
    </style>
</head>
<body>
    <div id="sidebar">
        <div class="logo"><span class="ttred">Tik</span>Finity</div>
        <div class="separator"></div>
        
        <div class="channel-info">
            <table id="siebarChannelInfoTable" onclick="connectToTikTok()">
                <tr>
                    <td><img src="https://via.placeholder.com/100" class="roundImage myChannelThumbnail" onerror="this.src='https://via.placeholder.com/100'"></td>
                    <td>
                        <div id="siebarChannelInfoTableUsername">Not Connected</div>
                        <div id="siebarChannelInfoTableStatus" class="status-text">Click to connect!</div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="separator"></div>
        
        <div class="menu-item" onclick="openSubmenu('Start', ['Dashboard', 'Quick Start', 'Status'])">
            <i class="fas fa-play"></i> Start
        </div>
        
        <div class="menu-item active" onclick="openSubmenu('Setup', ['TikTok Connection', 'Points System', 'Level Settings', 'OBS Integration', 'Advanced Settings'], true)">
            <i class="fas fa-cog"></i> Setup
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-desktop"></i></div>
        
        <div class="menu-item" onclick="openSubmenu('Overlay Gallery', ['Coin Match PRO', 'Wheel Of Actions PRO', 'Gift Cannon PRO', 'Chat', 'Gift Feed', 'Points Animation'])">
            <i class="fas fa-th"></i> Overlay Gallery
        </div>
        
        <div class="menu-item" onclick="openSubmenu('Goal Overlays', ['Likes PRO', 'Shares PRO', 'Follows PRO', 'Viewer Count PRO', 'Custom Goals'])">
            <i class="fas fa-bullseye"></i> Goal Overlays
        </div>
        
        <div class="menu-item" onclick="openSubmenu('Gift Overlays', ['Rose', 'TikTok', 'Finger Heart', 'Doughnut', 'Galaxy'])">
            <i class="fas fa-gift"></i> Gift Overlays
        </div>
        
        <div class="menu-item" onclick="openSubmenu('Last X Overlays', ['Last Follower', 'Last Gifter', 'Last Subscriber', 'Last Sharer'])">
            <i class="fas fa-history"></i> Last X Overlays
        </div>
        
        <div class="menu-item">
            <i class="fas fa-video"></i> OBS Docks
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-bolt"></i></div>
        
        <div class="menu-item" onclick="openSubmenu('Sound Alerts', ['Gift Sounds', 'Follow Sounds', 'Share Sounds', 'Custom Sounds'])">
            <i class="fas fa-volume-up"></i> Sound Alerts
        </div>
        
        <div class="menu-item" onclick="openSubmenu('Actions & Events', ['Gift Actions', 'Follow Actions', 'Comment Actions', 'Custom Events'])">
            <i class="fas fa-bolt"></i> Actions & Events
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="far fa-comments"></i></div>
        
        <div class="menu-item">
            <i class="far fa-comments"></i> Chat Commands
        </div>
        
        <div class="menu-item" onclick="openSubmenu('Chatbot', ['Settings', 'Auto Responses', 'Keyword Triggers'])">
            <i class="fas fa-robot"></i> Chatbot
        </div>
        
        <div class="menu-item" onclick="openSubmenu('TTS Chat', ['Settings', 'Voice Selection', 'Overlay'])">
            <i class="fas fa-microphone"></i> TTS Chat
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-list-ul"></i></div>
        
        <div class="menu-item">
            <i class="fas fa-users"></i> User & Points
        </div>
        
        <div class="menu-item">
            <i class="fas fa-exchange-alt"></i> Transactions
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-headphones"></i></div>
        
        <div class="menu-item" onclick="openSubmenu('Song Requests', ['Settings', 'Queue', 'Overlay'])">
            <i class="fas fa-music"></i> Song Requests
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-gamepad"></i></div>
        
        <div class="menu-item" onclick="openSubmenu('Likeathon', ['Settings', 'Overlay'])">
            <i class="fas fa-heart"></i> Likeathon
        </div>
        
        <div class="menu-item" onclick="openSubmenu('Timer', ['Subathon', 'Countdown', 'Stopwatch'])">
            <i class="fas fa-clock"></i> Timer
        </div>
        
        <div class="menu-item" onclick="openSubmenu('Wheel of Fortune', ['Settings', 'Overlay'])">
            <i class="fas fa-dharmachakra"></i> Wheel of Fortune
        </div>
        
        <div class="menu-item" onclick="openSubmenu('Points Drop', ['Settings', 'Overlay'])">
            <i class="fas fa-coins"></i> Points Drop
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-tools"></i></div>
        
        <div class="menu-item">
            <i class="fas fa-trophy"></i> Challenge
        </div>
        
        <div class="menu-item">
            <i class="fas fa-divide"></i> Halving
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-database"></i></div>
        
        <div class="menu-item">
            <i class="fas fa-code"></i> Event API
        </div>
    </div>
    
    <div id="submenuPanel">
        <div class="panel-title" id="submenuTitle">Menu</div>
        <div id="submenuContent"></div>
    </div>
    
    <div class="main-content">
        <h1>Setup</h1>
        <p style="color: #888; margin-bottom: 30px;">Here you can define the basic settings.</p>
        
        <div class="section" id="tiktokName">
            <div class="field">
                <label>Your TikTok Name (<span class="ttred">Required!</span>)</label>
                <input type="text" placeholder="@username" id="textboxChannelName">
                <div style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="connectToTikTok()"><i class="fas fa-broadcast-tower"></i> Connect</button>
                </div>
            </div>
        </div>
        
        <div class="section" id="pointsSystemSettings">
            <h3>Points System</h3>
            <div class="field">
                <label>Currency Name</label>
                <input type="text" value="Points">
            </div>
            <div class="checkbox"><input type="checkbox" checked> Points per coin</div>
            <div class="checkbox"><input type="checkbox"> Points per share</div>
        </div>
        
        <div class="section" id="levelSettings">
            <h3>Level Settings</h3>
            <div class="field">
                <label>Max Level</label>
                <input type="number" value="100">
            </div>
        </div>
        
        <div class="section" id="obsConnection">
            <h3>OBS Integration</h3>
            <div class="field">
                <label>OBS WebSocket URL</label>
                <input type="text" placeholder="ws://localhost:4455">
            </div>
        </div>
        
        <div class="section" id="advancedSettings">
            <h3>Advanced Settings</h3>
            <div class="checkbox"><input type="checkbox" checked> Use localized gift names</div>
            <div class="checkbox"><input type="checkbox" checked> Use display names</div>
            <div class="field">
                <label>TikTok Language</label>
                <input type="text" placeholder="tr-TR" style="max-width: 200px;">
            </div>
        </div>
        
        <div class="section" id="accountSection">
            <h3>Your Account</h3>
            <table>
                <tr><td>User-ID</td><td>{{ user.id|default:"Not logged in" }}</td></tr>
                <tr><td>E-Mail</td><td>{{ user.email|default:"N/A" }}</td></tr>
            </table>
            <br>
            {% if user.is_authenticated %}
            <button class="btn" onclick="location.href='/tiktok/logout/'">Logout</button>
            {% else %}
            <button class="btn" onclick="location.href='{% url 'tiktok_live:tiktok_oauth_login' %}'"><i class="fab fa-tiktok"></i> Login with TikTok</button>
            <button class="btn" onclick="location.href='{% url 'tiktok_live:google_oauth_login' %}'"><i class="fab fa-google"></i> Login with Google</button>
            {% endif %}
        </div>
    </div>

    <script>
        let currentPanel = null;
        
        function openSubmenu(title, items, hasScroll = false) {
            const panel = document.getElementById('submenuPanel');
            const titleEl = document.getElementById('submenuTitle');
            const content = document.getElementById('submenuContent');
            const mainContent = document.querySelector('.main-content');
            
            if (currentPanel === title && panel.classList.contains('open')) {
                panel.classList.remove('open');
                mainContent.classList.remove('shifted');
                currentPanel = null;
                return;
            }
            
            titleEl.textContent = title;
            content.innerHTML = '';
            
            const sections = ['tiktokName', 'pointsSystemSettings', 'levelSettings', 'obsConnection', 'advancedSettings'];
            
            items.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'submenu-item';
                div.textContent = item;
                if (hasScroll && idx < sections.length) {
                    div.onclick = () => scrollToSection(sections[idx]);
                }
                content.appendChild(div);
            });
            
            panel.classList.add('open');
            mainContent.classList.add('shifted');
            currentPanel = title;
        }
        
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function connectToTikTok() {
            const username = document.getElementById('textboxChannelName').value.trim().replace('@', '');
            if (!username) { 
                alert('Please enter TikTok username first!');
                return;
            }
            localStorage.setItem('tiktok_username', username);
            document.getElementById('siebarChannelInfoTableUsername').textContent = username;
            document.getElementById('siebarChannelInfoTableStatus').textContent = 'OFFLINE';
            document.getElementById('siebarChannelInfoTableStatus').className = 'status-text offline';
            alert('âœ… Connected to @' + username);
            checkLiveStatus(username);
        }
        
        function checkLiveStatus(username) {
            fetch(`/tiktok/api/check-live/${username}/`)
                .then(res => res.json())
                .then(data => {
                    const statusEl = document.getElementById('siebarChannelInfoTableStatus');
                    if (data.is_live) {
                        statusEl.textContent = 'LIVE';
                        statusEl.className = 'status-text live';
                    } else {
                        statusEl.textContent = 'OFFLINE';
                        statusEl.className = 'status-text offline';
                    }
                })
                .catch(() => {
                    document.getElementById('siebarChannelInfoTableStatus').textContent = 'OFFLINE';
                    document.getElementById('siebarChannelInfoTableStatus').className = 'status-text offline';
                });
        }
        
        window.onload = function() {
            const saved = localStorage.getItem('tiktok_username');
            if (saved) {
                document.getElementById('textboxChannelName').value = saved;
                document.getElementById('siebarChannelInfoTableUsername').textContent = saved;
                checkLiveStatus(saved);
                setInterval(() => checkLiveStatus(saved), 30000);
            }
        };
    </script>
</body>
</html>
