<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikFinity - Setup</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #fff; }
        
        #sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background: #1a1a1a; border-right: 1px solid #333; overflow-y: auto; z-index: 100; }
        .logo { padding: 20px; font-size: 1.5em; font-weight: bold; }
        .ttred { color: #fe2c55; }
        .separator { height: 1px; background: #333; margin: 10px 15px; }
        
        .channel-info { padding: 10px 15px; }
        .channel-info table { width: 100%; cursor: pointer; }
        .channel-info td { padding: 5px; }
        .roundImage { width: 50px; height: 50px; border-radius: 50%; }
        .status-text { color: #888; font-size: 0.9em; }
        .status-text.connected { color: #10b981; }
        .status-text.live { color: #fe2c55; font-weight: bold; }
        .status-text.offline { color: #888; }
        
        .menu-item { padding: 12px 20px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover { background: #252525; border-left-color: #fe2c55; }
        .menu-item.active { background: #252525; border-left-color: #fe2c55; color: #fe2c55; }
        .menu-item i { width: 20px; }
        
        .submenu-container { max-height: 0; overflow: hidden; transition: max-height 0.3s; background: #151515; }
        .submenu-container.open { max-height: 500px; }
        .submenu-item { padding: 12px 20px 12px 40px; cursor: pointer; transition: all 0.3s; border-left: 3px solid transparent; font-size: 0.9em; color: #aaa; }
        .submenu-item:hover { background: #252525; color: #fe2c55; border-left-color: #fe2c55; }
        
        .main-content { margin-left: 250px; padding: 30px; min-height: 100vh; }
        
        .section { background: #1a1a1a; padding: 30px; border-radius: 12px; margin-bottom: 20px; }
        .section h3 { color: #667eea; margin-bottom: 15px; }
        .field { margin-bottom: 20px; }
        .field label { display: block; margin-bottom: 8px; }
        .field input { width: 100%; max-width: 500px; padding: 12px; background: #252525; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; background: #667eea; color: white; margin: 5px; }
        .btn:hover { background: #5568d3; }
        .btn-success { background: #10b981; }
        .checkbox { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        table { width: 100%; max-width: 600px; border-collapse: collapse; }
        table td { padding: 10px; border-bottom: 1px solid #333; }
    </style>
</head>
<body>
    <div id="sidebar">
        <div class="logo"><span class="ttred">Tik</span>Finity</div>
        <div class="separator"></div>
        
        <div class="channel-info">
            <table id="siebarChannelInfoTable" onclick="connectToTikTok()">
                <tr>
                    <td><img src="https://via.placeholder.com/100" class="roundImage myChannelThumbnail" onerror="this.src='https://via.placeholder.com/100'"></td>
                    <td>
                        <div id="siebarChannelInfoTableUsername">Not Connected</div>
                        <div id="siebarChannelInfoTableStatus" class="status-text">Click to connect!</div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="separator"></div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-play"></i> Start
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Dashboard</div>
            <div class="submenu-item">Quick Start</div>
            <div class="submenu-item">Status</div>
        </div>
        
        <div class="menu-item active" onclick="toggleSubmenu(this)">
            <i class="fas fa-cog"></i> Setup
        </div>
        <div class="submenu-container open">
            <div class="submenu-item" onclick="scrollToSection('tiktokName')">TikTok Connection</div>
            <div class="submenu-item" onclick="scrollToSection('pointsSystemSettings')">Points System</div>
            <div class="submenu-item" onclick="scrollToSection('levelSettings')">Level Settings</div>
            <div class="submenu-item" onclick="scrollToSection('obsConnection')">OBS Integration</div>
            <div class="submenu-item" onclick="scrollToSection('advancedSettings')">Advanced Settings</div>
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-desktop"></i></div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-th"></i> Overlay Gallery
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Coin Match PRO</div>
            <div class="submenu-item">Wheel Of Actions PRO</div>
            <div class="submenu-item">Gift Cannon PRO</div>
            <div class="submenu-item">Chat</div>
            <div class="submenu-item">Gift Feed</div>
            <div class="submenu-item">Points Animation</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-bullseye"></i> Goal Overlays
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Likes PRO</div>
            <div class="submenu-item">Shares PRO</div>
            <div class="submenu-item">Follows PRO</div>
            <div class="submenu-item">Viewer Count PRO</div>
            <div class="submenu-item">Custom Goals</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-gift"></i> Gift Overlays
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Rose</div>
            <div class="submenu-item">TikTok</div>
            <div class="submenu-item">Finger Heart</div>
            <div class="submenu-item">Doughnut</div>
            <div class="submenu-item">Galaxy</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-history"></i> Last X Overlays
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Last Follower</div>
            <div class="submenu-item">Last Gifter</div>
            <div class="submenu-item">Last Subscriber</div>
            <div class="submenu-item">Last Sharer</div>
        </div>
        
        <div class="menu-item">
            <i class="fas fa-video"></i> OBS Docks
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-bolt"></i></div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-volume-up"></i> Sound Alerts
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Gift Sounds</div>
            <div class="submenu-item">Follow Sounds</div>
            <div class="submenu-item">Share Sounds</div>
            <div class="submenu-item">Custom Sounds</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-bolt"></i> Actions & Events
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Gift Actions</div>
            <div class="submenu-item">Follow Actions</div>
            <div class="submenu-item">Comment Actions</div>
            <div class="submenu-item">Custom Events</div>
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="far fa-comments"></i></div>
        
        <div class="menu-item">
            <i class="far fa-comments"></i> Chat Commands
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-robot"></i> Chatbot
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Settings</div>
            <div class="submenu-item">Auto Responses</div>
            <div class="submenu-item">Keyword Triggers</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-microphone"></i> TTS Chat
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Settings</div>
            <div class="submenu-item">Voice Selection</div>
            <div class="submenu-item">Overlay</div>
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-list-ul"></i></div>
        
        <div class="menu-item">
            <i class="fas fa-users"></i> User & Points
        </div>
        
        <div class="menu-item">
            <i class="fas fa-exchange-alt"></i> Transactions
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-headphones"></i></div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-music"></i> Song Requests
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Settings</div>
            <div class="submenu-item">Queue</div>
            <div class="submenu-item">Overlay</div>
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-gamepad"></i></div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-heart"></i> Likeathon
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Settings</div>
            <div class="submenu-item">Overlay</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-clock"></i> Timer
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Subathon</div>
            <div class="submenu-item">Countdown</div>
            <div class="submenu-item">Stopwatch</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-dharmachakra"></i> Wheel of Fortune
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Settings</div>
            <div class="submenu-item">Overlay</div>
        </div>
        
        <div class="menu-item" onclick="toggleSubmenu(this)">
            <i class="fas fa-coins"></i> Points Drop
        </div>
        <div class="submenu-container">
            <div class="submenu-item">Settings</div>
            <div class="submenu-item">Overlay</div>
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-tools"></i></div>
        
        <div class="menu-item">
            <i class="fas fa-trophy"></i> Challenge
        </div>
        
        <div class="menu-item">
            <i class="fas fa-divide"></i> Halving
        </div>
        
        <div class="separator"></div>
        <div style="padding: 10px 20px; color: #888; font-size: 0.9em;"><i class="fas fa-database"></i></div>
        
        <div class="menu-item">
            <i class="fas fa-code"></i> Event API
        </div>
    </div>
    
    <div class="main-content">
        <h1>Setup</h1>
        <p style="color: #888; margin-bottom: 30px;">Here you can define the basic settings.</p>
        
        <div class="section" id="tiktokName">
            <div class="field">
                <label>Your TikTok Name (<span class="ttred">Required!</span>)</label>
                <input type="text" placeholder="@username" id="textboxChannelName">
                <div style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="connectToTikTok()"><i class="fas fa-broadcast-tower"></i> Connect</button>
                </div>
            </div>
        </div>
        
        <div class="section" id="pointsSystemSettings">
            <h3>Points System</h3>
            <div class="field">
                <label>Currency Name</label>
                <input type="text" value="Points">
            </div>
            <div class="checkbox"><input type="checkbox" checked> Points per coin</div>
            <div class="checkbox"><input type="checkbox"> Points per share</div>
        </div>
        
        <div class="section" id="levelSettings">
            <h3>Level Settings</h3>
            <div class="field">
                <label>Max Level</label>
                <input type="number" value="100">
            </div>
        </div>
        
        <div class="section" id="obsConnection">
            <h3>OBS Integration</h3>
            <div class="field">
                <label>OBS WebSocket URL</label>
                <input type="text" placeholder="ws://localhost:4455">
            </div>
        </div>
        
        <div class="section" id="advancedSettings">
            <h3>Advanced Settings</h3>
            <div class="checkbox"><input type="checkbox" checked> Use localized gift names</div>
            <div class="checkbox"><input type="checkbox" checked> Use display names</div>
            <div class="field">
                <label>TikTok Language</label>
                <input type="text" placeholder="tr-TR" style="max-width: 200px;">
            </div>
        </div>
        
        <div class="section" id="accountSection">
            <h3>Your Account</h3>
            <table>
                <tr><td>User-ID</td><td>{{ user.id|default:"Not logged in" }}</td></tr>
                <tr><td>E-Mail</td><td>{{ user.email|default:"N/A" }}</td></tr>
            </table>
            <br>
            {% if user.is_authenticated %}
            <button class="btn" onclick="location.href='/tiktok/logout/'">Logout</button>
            {% else %}
            <button class="btn" onclick="location.href='{% url 'tiktok_live:tiktok_oauth_login' %}'"><i class="fab fa-tiktok"></i> Login with TikTok</button>
            <button class="btn" onclick="location.href='{% url 'tiktok_live:google_oauth_login' %}'"><i class="fab fa-google"></i> Login with Google</button>
            {% endif %}
        </div>
    </div>

    <script>
        function toggleSubmenu(menuItem) {
            const submenu = menuItem.nextElementSibling;
            if (submenu && submenu.classList.contains('submenu-container')) {
                submenu.classList.toggle('open');
            }
        }
        
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function connectToTikTok() {
            const username = document.getElementById('textboxChannelName').value.trim().replace('@', '');
            if (!username) { 
                alert('Please enter TikTok username first!');
                return;
            }
            localStorage.setItem('tiktok_username', username);
            document.getElementById('siebarChannelInfoTableUsername').textContent = username;
            document.getElementById('siebarChannelInfoTableStatus').textContent = 'OFFLINE';
            document.getElementById('siebarChannelInfoTableStatus').className = 'status-text offline';
            alert('âœ… Connected to @' + username);
            checkLiveStatus(username);
        }
        
        function checkLiveStatus(username) {
            fetch(`/tiktok/api/check-live/${username}/`)
                .then(res => res.json())
                .then(data => {
                    const statusEl = document.getElementById('siebarChannelInfoTableStatus');
                    if (data.is_live) {
                        statusEl.textContent = 'LIVE';
                        statusEl.className = 'status-text live';
                    } else {
                        statusEl.textContent = 'OFFLINE';
                        statusEl.className = 'status-text offline';
                    }
                })
                .catch(() => {
                    document.getElementById('siebarChannelInfoTableStatus').textContent = 'OFFLINE';
                    document.getElementById('siebarChannelInfoTableStatus').className = 'status-text offline';
                });
        }
        
        window.onload = function() {
            const saved = localStorage.getItem('tiktok_username');
            if (saved) {
                document.getElementById('textboxChannelName').value = saved;
                document.getElementById('siebarChannelInfoTableUsername').textContent = saved;
                checkLiveStatus(saved);
                setInterval(() => checkLiveStatus(saved), 30000);
            }
        };
    </script>
</body>
</html>
