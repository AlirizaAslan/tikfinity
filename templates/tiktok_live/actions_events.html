{% extends 'tiktok_live/base.html' %}

{% block page_title %}Actions & Events{% endblock %}

{% block extra_css %}
<style>
    .actions-events-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    .section-card {
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 25px;
    }

    .section-title {
        font-size: 20px;
        font-weight: 600;
        color: #4a90e2;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .btn {
        background-color: #4a90e2;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s;
        text-decoration: none;
        display: inline-block;
        margin-right: 10px;
        margin-bottom: 10px;
    }

    .btn:hover {
        background-color: #357abd;
    }

    .btn-success {
        background-color: #27ae60;
    }

    .btn-success:hover {
        background-color: #219a52;
    }

    .btn-danger {
        background-color: #e74c3c;
    }

    .btn-danger:hover {
        background-color: #c0392b;
    }

    .item-list {
        margin-top: 20px;
    }

    .item {
        background-color: #2a2a2a;
        border: 1px solid #444;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: between;
        align-items: center;
    }

    .item-info {
        flex: 1;
    }

    .item-name {
        font-weight: 600;
        color: #fff;
        margin-bottom: 5px;
    }

    .item-description {
        color: #ccc;
        font-size: 14px;
    }

    .item-actions {
        display: flex;
        gap: 10px;
    }

    .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .status-active {
        background-color: rgba(39, 174, 96, 0.2);
        color: #27ae60;
    }

    .status-inactive {
        background-color: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
    }

    .empty-state {
        text-align: center;
        padding: 40px;
        color: #888;
    }

    .empty-state i {
        font-size: 48px;
        margin-bottom: 15px;
        display: block;
    }

    @media (max-width: 768px) {
        .actions-events-container {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="actions-events-page">
    <!-- Quick Stats -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="section-card">
            <div style="text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #4a90e2;">{{ actions.count }}</div>
                <div style="color: #ccc;">Actions</div>
            </div>
        </div>
        <div class="section-card">
            <div style="text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #27ae60;">{{ events.count }}</div>
                <div style="color: #ccc;">Events</div>
            </div>
        </div>
        <div class="section-card">
            <div style="text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #f39c12;">{{ timers.count }}</div>
                <div style="color: #ccc;">Timers</div>
            </div>
        </div>
    </div>

    <div class="actions-events-container">
        <!-- Actions Section -->
        <div class="section-card">
            <div class="section-title">
                üé¨ Actions
            </div>
            <p style="color: #ccc; margin-bottom: 20px;">
                Create custom actions that can be triggered by events or manually executed.
            </p>
            
            <button class="btn btn-success" onclick="createAction()">
                + Create Action
            </button>
            
            <div class="item-list">
                {% if actions %}
                    {% for action in actions %}
                    <div class="item">
                        <div class="item-info">
                            <div class="item-name">{{ action.name }}</div>
                            <div class="item-description">
                                Screen: {{ action.screen }} | Duration: {{ action.duration }}s
                                {% if action.points_change %}| Points: {{ action.points_change }}{% endif %}
                            </div>
                        </div>
                        <div class="item-actions">
                            <span class="status-badge {% if action.is_active %}status-active{% else %}status-inactive{% endif %}">
                                {% if action.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                            <button class="btn" onclick="playAction({{ action.id }})">Play</button>
                            <button class="btn" onclick="editAction({{ action.id }})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteAction({{ action.id }})">Delete</button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <i>üé¨</i>
                        <div>No actions created yet</div>
                        <div style="font-size: 14px; margin-top: 10px;">Create your first action to get started!</div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Events Section -->
        <div class="section-card">
            <div class="section-title">
                ‚ö° Events
            </div>
            <p style="color: #ccc; margin-bottom: 20px;">
                Set up triggers that automatically execute actions based on stream events.
            </p>
            
            <button class="btn btn-success" onclick="createEvent()">
                + Create Event
            </button>
            
            <div class="item-list">
                {% if events %}
                    {% for event in events %}
                    <div class="item">
                        <div class="item-info">
                            <div class="item-name">{{ event.get_trigger_type_display }}</div>
                            <div class="item-description">
                                {% if event.min_coins %}Min Coins: {{ event.min_coins }}{% endif %}
                                {% if event.specific_user %}User: {{ event.specific_user }}{% endif %}
                                {% if event.custom_command %}Command: {{ event.custom_command }}{% endif %}
                            </div>
                        </div>
                        <div class="item-actions">
                            <span class="status-badge {% if event.is_active %}status-active{% else %}status-inactive{% endif %}">
                                {% if event.is_active %}Active{% else %}Inactive{% endif %}
                            </span>
                            <button class="btn" onclick="simulateEvent('{{ event.trigger_type }}')">Test</button>
                            <button class="btn" onclick="editEvent({{ event.id }})">Edit</button>
                            <button class="btn btn-danger" onclick="deleteEvent({{ event.id }})">Delete</button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <i>‚ö°</i>
                        <div>No events configured yet</div>
                        <div style="font-size: 14px; margin-top: 10px;">Create events to automate your stream!</div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Timers Section -->
    <div class="section-card">
        <div class="section-title">
            ‚è±Ô∏è Timers
        </div>
        <p style="color: #ccc; margin-bottom: 20px;">
            Schedule actions to run automatically at specified intervals.
        </p>
        
        <button class="btn btn-success" onclick="createTimer()">
            + Create Timer
        </button>
        
        <div class="item-list">
            {% if timers %}
                {% for timer in timers %}
                <div class="item">
                    <div class="item-info">
                        <div class="item-name">{{ timer.action.name }}</div>
                        <div class="item-description">
                            Interval: {{ timer.interval_minutes }} minutes
                        </div>
                    </div>
                    <div class="item-actions">
                        <span class="status-badge {% if timer.is_active %}status-active{% else %}status-inactive{% endif %}">
                            {% if timer.is_active %}Active{% else %}Inactive{% endif %}
                        </span>
                        <button class="btn btn-danger" onclick="deleteTimer({{ timer.id }})">Delete</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i>‚è±Ô∏è</i>
                    <div>No timers configured yet</div>
                    <div style="font-size: 14px; margin-top: 10px;">Create timers to automate recurring actions!</div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function createAction() {
        alert('Create Action functionality will be implemented');
    }

    function editAction(actionId) {
        alert('Edit Action ' + actionId + ' functionality will be implemented');
    }

    function deleteAction(actionId) {
        if (confirm('Are you sure you want to delete this action?')) {
            alert('Delete Action ' + actionId + ' functionality will be implemented');
        }
    }

    function playAction(actionId) {
        alert('Play Action ' + actionId + ' functionality will be implemented');
    }

    function createEvent() {
        alert('Create Event functionality will be implemented');
    }

    function editEvent(eventId) {
        alert('Edit Event ' + eventId + ' functionality will be implemented');
    }

    function deleteEvent(eventId) {
        if (confirm('Are you sure you want to delete this event?')) {
            alert('Delete Event ' + eventId + ' functionality will be implemented');
        }
    }

    function simulateEvent(eventType) {
        alert('Simulate ' + eventType + ' event functionality will be implemented');
    }

    function createTimer() {
        alert('Create Timer functionality will be implemented');
    }

    function deleteTimer(timerId) {
        if (confirm('Are you sure you want to delete this timer?')) {
            alert('Delete Timer ' + timerId + ' functionality will be implemented');
        }
    }
</script>
{% endblock %}